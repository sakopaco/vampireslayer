Sjasm Z80 Assembler v0.42c - www.xl2s.tk             [2021.06.24 - 18:24:33]

pm.asm
Errors: 0

       1   00:0000                      	output "pm.bin"
       2   00:8200                      	
       3   00:8200                      	
       4   00:8200  (00:009F)           CHGET	equ		#009F
       5   00:8200  (00:00A2)           CHPUT	equ		#00A2
       6   00:8200  (00:00C6)           POSIT	equ		#00C6
       7   00:8200  (00:00B1)           INLIN   equ		#00B1
       8   00:8200  (00:00D8)           GTTRIG	equ		#00D8
       9   00:8200                      
      10   00:8200  (00:013E)           RDVDP	equ		#013E
      11   00:8200  (00:0047)           WRTVDP	equ		#0047
      12   00:8200  (00:005C)           LDIRVM	equ		#005C
      13   00:8200  (00:0059)           LDIRMV	equ		#0059
      14   00:8200  (00:005F)           CHGMOD	equ		#005F
      15   00:8200                      
      16   00:8200  (00:F3DF)           RG0SAV	equ		#F3DF
      17   00:8200  (00:F3E0)           RG1SAV	equ		#F3E0
      18   00:8200  (00:F3E1)           RG2SAV	equ		#F3E1
      19   00:8200  (00:F3E2)           RG3SAV	equ		#F3E2
      20   00:8200  (00:F3E3)           RG4SAV	equ		#F3E3
      21   00:8200  (00:F3E4)           RG5SAV	equ		#F3E4
      22   00:8200  (00:F3E5)           RG6SAV	equ		#F3E5
      23   00:8200  (00:F3E6)           RG7SAV	equ		#F3E6
      24   00:8200  (00:F3E7)           STATFL	equ		#F3E7
      25   00:8200                      
      26   00:8200  (00:0099)           REGEST		equ		#0099	;registro de estado para escribir directamente en VRAM
      27   00:8200  (00:0098)           REGESCVDP	equ		#0098	;registro donde escribir valor para VRAM
      28   00:8200                      
      29   00:8200  (00:1800)           SC2MAP  equ		#1800
      30   00:8200                      
      31   00:8200                      
      32   00:8200  FE                  	db	#FE
      33   00:8201  00 82               	dw	START
      34   00:8203  CE 82               	dw	END
      35   00:8205  00 82               	dw	START
      36   00:8207                      	
      37   00:8207                      	
      38   00:8207                      	ORG	#8200
      39   00:8200                      	
      40   00:8200                      	
      41   00:8200                      START:
      42   00:8200                      	;ponemos screen 2
      43   00:8200  3E 02               	LD	 	A,2
      44   00:8202  CD 5F 00            	CALL 	CHGMOD
      45   00:8205                      	
      46   00:8205                      	;cargando los tiles (voy a cargar el vacio y el lleno)
      47   00:8205                      	;tercio 1
      48   00:8205  21 A3 82            	LD		HL,tilevacio
      49   00:8208  11 00 00            	LD		DE,#0000
      50   00:820B  01 10 00            	LD		BC,2 * 8
      51   00:820E  CD 5C 00            	CALL	LDIRVM
      52   00:8211                      	;tercio 2
      53   00:8211  21 A3 82            	LD		HL,tilevacio
      54   00:8214  11 00 08            	LD		DE,#0800
      55   00:8217  01 10 00            	LD		BC,2 * 8
      56   00:821A  CD 5C 00            	CALL	LDIRVM
      57   00:821D                      	;tercio 3
      58   00:821D  21 A3 82            	LD		HL,tilevacio
      59   00:8220  11 00 10            	LD		DE,#1000
      60   00:8223  01 10 00            	LD		BC,2 * 8
      61   00:8226  CD 5C 00            	CALL	LDIRVM
      62   00:8229                      	
      63   00:8229                      	
      64   00:8229                      	;cargando los colores de los tiles
      65   00:8229                      	;tercio 1
      66   00:8229  21 B3 82            	LD		HL,coltilevacio
      67   00:822C  11 00 20            	LD		DE,#2000
      68   00:822F  01 10 00            	LD		BC,2 * 8
      69   00:8232  CD 5C 00            	CALL	LDIRVM
      70   00:8235                      	
      71   00:8235                      	;tercio 2
      72   00:8235  21 B3 82            	LD		HL,coltilevacio
      73   00:8238  11 00 28            	LD		DE,#2800
      74   00:823B  01 10 00            	LD		BC,2 * 8
      75   00:823E  CD 5C 00            	CALL	LDIRVM
      76   00:8241                      	
      77   00:8241                      	;tercio 3
      78   00:8241  21 B3 82            	LD		HL,coltilevacio
      79   00:8244  11 00 30            	LD		DE,#3000
      80   00:8247  01 10 00            	LD		BC,2 * 8
      81   00:824A  CD 5C 00            	CALL	LDIRVM
      82   00:824D                      	
      83   00:824D                      	
      84   00:824D                      	;cargando los posiciones de los patrones de los tiles
      85   00:824D                      	;tercio 1
      86   00:824D  21 C3 82            	LD		HL,pattiles
      87   00:8250  11 00 18            	LD		DE,#1800
      88   00:8253  01 02 00            	LD		BC,2
      89   00:8256  CD 5C 00            	CALL	LDIRVM
      90   00:8259                      	
      91   00:8259                      	
      92   00:8259                      	
      93   00:8259                      	
      94   00:8259  21 00 19            	LD		HL,SC2MAP + 256
      95   00:825C  22 9F 82            	LD		(wordaux1),HL
      96   00:825F  44                  	LD		B,H
      97   00:8260  4D                  	LD		C,L
      98   00:8261  16 02               	LD		D,2
      99   00:8263  1E 04               	LD		E,4
     100   00:8265  CD 6C 82            	CALL	pinta_array
     101   00:8268                      
     102   00:8268                      	
     103   00:8268                      	;esperamos que se pulse tecla
     104   00:8268  CD 9F 00            	CALL	CHGET
     105   00:826B                      	
     106   00:826B  C9                  	RET
     107   00:826C                      	
     108   00:826C                      ;;***************************************************
     109   00:826C                      ;;subrutina pinta array
     110   00:826C                      ;;***************************************************
     111   00:826C                      ;;funcion:  se le pasa un array con posiciones de tiles y coordenadas x e y y los pinta en screen 2
     112   00:826C                      ;;entrada:	array_tiles HL, BC (posición en tilemap) , D filas y E columnas
     113   00:826C                      ;;salida:	-
     114   00:826C                      ;;guardar BC
     115   00:826C                      pinta_array:
     116   00:826C                      	;contamos con que la posición "global" en el tilemap está ya en BC
     117   00:826C                      	
     118   00:826C                      	;inicializa
     119   00:826C  DB 99               	IN		 A,(REGEST)		;leer registro de estado (recomendado)
     120   00:826E                      	
     121   00:826E                      	;coloca puntero para pintar tile según BC
     122   00:826E  79                  	LD		 A,C			;primero byte bajo	
     123   00:826F  D3 99               	OUT		(REGEST),A
     124   00:8271  78                  	LD		 A,B			;después byte alto  ********************** preguntar a Fernando cómo que byte bajo es B
     125   00:8272  F6 40               	OR		1000000b		;+64
     126   00:8274  D3 99               	OUT		(REGEST),A
     127   00:8276                      
     128   00:8276                      	
     129   00:8276  21 C6 82            	LD		HL,array_tiles
     130   00:8279                      .pa_pinta_fila:
     131   00:8279  43                  	LD		 B,E
     132   00:827A                      .pa_pinta_columnas: ;finta la fila (pintando las columnas)
     133   00:827A  7E                  	LD		 A,(HL)
     134   00:827B  D3 98               	OUT		(REGESCVDP),A	;escribe A en VRAM en la posición indicada por los dos OUT anteriores
     135   00:827D  23                  	INC		HL
     136   00:827E  10 FA               	DJNZ	.pa_pinta_columnas
     137   00:8280                      	
     138   00:8280                      	;no es una solución elegante lo de repetir código pero queda claro
     139   00:8280                      	;por si hay otra fila
     140   00:8280  E5                  	PUSH	HL
     141   00:8281  2A 9F 82            	LD		HL,(wordaux1)
     142   00:8284  01 20 00            	LD		BC,32
     143   00:8287  09                  	ADD		HL,BC
     144   00:8288  22 9F 82            	LD		(wordaux1),HL
     145   00:828B  44                  	LD		B,H
     146   00:828C  4D                  	LD		C,L
     147   00:828D  E1                  	POP		HL
     148   00:828E                      	
     149   00:828E  79                  	LD		 A,C			;primero byte bajo	
     150   00:828F  D3 99               	OUT		(REGEST),A
     151   00:8291  78                  	LD		 A,B			;después byte alto  ********************** preguntar a Fernando cómo que byte bajo es B
     152   00:8292  F6 40               	OR		1000000b		;+64
     153   00:8294  D3 99               	OUT		(REGEST),A
     154   00:8296                      	
     155   00:8296                      	;si hay otra fila repite
     156   00:8296  15                  	DEC		 D
     157   00:8297  7A                  	LD		 A,D		;¿hay otra fila?
     158   00:8298  B7                  	OR		 A
     159   00:8299  C2 79 82            	JP		NZ,.pa_pinta_fila
     160   00:829C                      	
     161   00:829C                      	
     162   00:829C                      fin_pinta_array:
     163   00:829C  C9                  	RET
     164   00:829D                      
     165   00:829D                      byteaux1:
     166   00:829D  00                  	DB	0
     167   00:829E                      byteaux2:
     168   00:829E  00                  	DB	0
     169   00:829F                      wordaux1:
     170   00:829F  00 00               	DW	0
     171   00:82A1                      wordaux2:
     172   00:82A1  00 00               	DW	0
     173   00:82A3                      
     174   00:82A3                      tilevacio:
     175   00:82A3                      	DB	0,0,0,0,0,0,0,0
     175   00:82A3  00 00 00 00 00 00 00 00 
     176   00:82AB                      
     177   00:82AB                      tilelleno:
     178   00:82AB                      	DB	#FF,#FE,#FF,#FE,#FF,#FE,#FF,#FE
     178   00:82AB  FF FE FF FE FF FE FF FE 
     179   00:82B3                      	
     180   00:82B3                      coltilevacio:
     181   00:82B3                      	DB	0,0,0,0,0,0,0,0
     181   00:82B3  00 00 00 00 00 00 00 00 
     182   00:82BB                      
     183   00:82BB                      coltilelleno:
     184   00:82BB                      	DB	#FE,#FF,#FE,#FF,#FE,#FF,#FE,#FF
     184   00:82BB  FE FF FE FF FE FF FE FF 
     185   00:82C3                      
     186   00:82C3                      pattiles:
     187   00:82C3  00 01 02            	DB	#0000,#0001,#0002
     188   00:82C6                      	
     189   00:82C6                      array_tiles:
     190   00:82C6                      	DB	1,0,1,1,1,1,1,1
     190   00:82C6  01 00 01 01 01 01 01 01 
     191   00:82CE                      
     192   00:82CE                      END:
     193   00:82CE                      	
     194   00:82CE                      	
     195   00:82CE                      	;~ ;opciones que barajo
     196   00:82CE                      	;~ ;a) pintar por filas
     197   00:82CE                      	;~ LD		HL,array_aux_vidas
     198   00:82CE                      	;~ LD		DE,SC2MAP + POSVIDAS 	;inicio posición en el mapa de tiles de las vidas
     199   00:82CE                      	;~ LD		BC,NMAXVIDREL			;hay 8 posiciones para vidas/reliquias o espacios en negro si no tiene 8 vidas/reliquias
     200   00:82CE                      	;~ CALL	LDIRVM
     201   00:82CE                      	
     202   00:82CE                      	
     203   00:82CE                      	;~ ;b) pintar cada tile individualmente
     204   00:82CE                      	;~ IN		 A,(REGEST)		;leer registro de estado (recomendado)
     205   00:82CE                      	;~ LD		 A,C			;primero byte bajo	
     206   00:82CE                      	;~ OUT		(REGEST),A
     207   00:82CE                      	;~ LD		 A,B			;después byte alto  ********************** preguntar a Fernando cómo que byte bajo es B
     208   00:82CE                      	;~ OR		1000000b		;+64
     209   00:82CE                      	;~ OUT		(REGEST),A
     210   00:82CE                      	
     211   00:82CE                      	;~ LD		A,D
     212   00:82CE                      	;~ OUT		(REGESCVDP),A	;escribe A en VRAM en la posición indicada por los dos OUT anteriores
     213   00:82CE                      	
     214   00:82CE                      	
     215   00:82CE                      	
     216   00:82CE                      	
     217   00:82CE                      	
     218   00:82CE                      	
     219   00:82CE                      	
     220   00:82CE                      	
     221   00:82CE                      	

    LABELS
-------------------------------------------------
00:0000009F   CHGET
00:000000A2 X CHPUT
00:000000C6 X POSIT
00:000000B1 X INLIN
00:000000D8 X GTTRIG
00:0000013E X RDVDP
00:00000047 X WRTVDP
00:0000005C   LDIRVM
00:00000059 X LDIRMV
00:0000005F   CHGMOD
00:0000F3DF X RG0SAV
00:0000F3E0 X RG1SAV
00:0000F3E1 X RG2SAV
00:0000F3E2 X RG3SAV
00:0000F3E3 X RG4SAV
00:0000F3E4 X RG5SAV
00:0000F3E5 X RG6SAV
00:0000F3E6 X RG7SAV
00:0000F3E7 X STATFL
00:00000099   REGEST
00:00000098   REGESCVDP
00:00001800   SC2MAP
00:00008200   START
00:0000826C   pinta_array
00:00008279   pinta_array.pa_pinta_fila
00:0000827A   pinta_array.pa_pinta_columnas
00:0000829C X fin_pinta_array
00:0000829D X byteaux1
00:0000829E X byteaux2
00:0000829F   wordaux1
00:000082A1 X wordaux2
00:000082A3   tilevacio
00:000082AB X tilelleno
00:000082B3   coltilevacio
00:000082BB X coltilelleno
00:000082C3   pattiles
00:000082C6   array_tiles
00:000082CE   END


 Output: pm.out
-------------------------------------------------

 Page: 00
  Org: 00008200  Size: *  Used: 00000000

    No output

 Output: pm.bin
-------------------------------------------------

 Page: 00
  Org: 00008200  Size: *  Used: 000000D5

   Address   Length Align   Label
   00008200     213         START
